<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÌèâÏÉù ÌÅ¥Îûú Îß§Ïπò ÌÜµÍ≥Ñ ÏÑúÎπÑÏä§</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: #fff;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            background: rgba(255,255,255,0.1);
            padding: 30px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .subtitle {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .status-bar {
            background: rgba(76, 175, 80, 0.9);
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
        }

        .status-bar.loading {
            background: rgba(255, 152, 0, 0.9);
        }

        .status-bar.error {
            background: rgba(244, 67, 54, 0.9);
        }

        .last-update {
            font-size: 0.9em;
        }

        .refresh-btn {
            background: white;
            color: #4CAF50;
            border: none;
            padding: 8px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .refresh-btn:hover {
            background: #f5f5f5;
            transform: translateY(-2px);
        }

        .controls {
            background: rgba(255,255,255,0.1);
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
            backdrop-filter: blur(10px);
        }

        .date-controls {
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
            margin-bottom: 20px;
            justify-content: center;
        }

        .quick-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            background: rgba(255,255,255,0.2);
            color: white;
            border: 1px solid rgba(255,255,255,0.3);
        }

        .btn:hover {
            background: rgba(255,255,255,0.3);
            transform: translateY(-2px);
        }

        .btn.active {
            background: #4CAF50;
            border-color: #4CAF50;
        }

        input[type="date"] {
            padding: 10px 15px;
            border: none;
            border-radius: 8px;
            background: rgba(255,255,255,0.2);
            color: white;
            border: 1px solid rgba(255,255,255,0.3);
            font-size: 16px;
        }

        input[type="date"]::-webkit-calendar-picker-indicator {
            filter: invert(1);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: rgba(255,255,255,0.1);
            padding: 25px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
            transition: all 0.3s ease;
            text-align: center;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            background: rgba(255,255,255,0.15);
        }

        .stat-card h3 {
            margin-bottom: 15px;
            color: #ffd700;
            font-size: 1.1em;
        }

        .stat-value {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .stat-label {
            opacity: 0.8;
            font-size: 0.9em;
        }

        .tabs {
            display: flex;
            gap: 5px;
            margin-bottom: 20px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .tab {
            padding: 12px 24px;
            background: rgba(255,255,255,0.1);
            border: none;
            border-radius: 10px 10px 0 0;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
        }

        .tab.active {
            background: rgba(255,255,255,0.2);
            border-bottom: 3px solid #ffd700;
        }

        .tab-content {
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 25px;
            backdrop-filter: blur(10px);
            min-height: 400px;
        }

        .table-container {
            overflow-x: auto;
            max-height: 600px;
            overflow-y: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: rgba(255,255,255,0.05);
        }

        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        th {
            background: rgba(255,255,255,0.1);
            font-weight: bold;
            position: sticky;
            top: 0;
            z-index: 10;
            color: #ffd700;
        }

        tr:hover {
            background: rgba(255,255,255,0.1);
        }

        .win {
            color: #4CAF50;
            font-weight: bold;
        }

        .lose {
            color: #f44336;
            font-weight: bold;
        }

        .player-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }

        .player-card {
            background: rgba(255,255,255,0.05);
            padding: 20px;
            border-radius: 10px;
            border-left: 4px solid #ffd700;
            transition: all 0.3s ease;
        }

        .player-card:hover {
            background: rgba(255,255,255,0.1);
            transform: translateX(5px);
        }

        .player-name {
            font-weight: bold;
            margin-bottom: 10px;
            color: #ffd700;
            font-size: 1.1em;
        }

        .player-stat {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            padding: 3px 0;
        }

        .loading {
            text-align: center;
            padding: 40px;
            font-size: 1.2em;
        }

        .spinner {
            border: 4px solid rgba(255,255,255,0.3);
            border-top: 4px solid #fff;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .search-box {
            width: 100%;
            max-width: 400px;
            padding: 12px;
            border: none;
            border-radius: 8px;
            background: rgba(255,255,255,0.2);
            color: white;
            margin: 0 auto 20px;
            font-size: 16px;
            display: block;
        }

        .search-box::placeholder {
            color: rgba(255,255,255,0.7);
        }

        .ranking-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .ranking-card {
            background: rgba(255,255,255,0.05);
            padding: 20px;
            border-radius: 10px;
            border-top: 3px solid #ffd700;
        }

        .ranking-card h4 {
            color: #ffd700;
            margin-bottom: 15px;
            text-align: center;
        }

        .ranking-item {
            display: flex;
            align-items: center;
            padding: 10px;
            margin-bottom: 8px;
            background: rgba(255,255,255,0.05);
            border-radius: 5px;
            transition: all 0.3s ease;
        }

        .ranking-item:hover {
            background: rgba(255,255,255,0.1);
            transform: translateX(5px);
        }

        .rank-number {
            font-size: 1.5em;
            font-weight: bold;
            color: #ffd700;
            width: 40px;
            text-align: center;
        }

        .rank-name {
            flex: 1;
            padding: 0 15px;
        }

        .rank-value {
            font-weight: bold;
            color: #4CAF50;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8em;
            }
            
            .date-controls {
                flex-direction: column;
                align-items: stretch;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            table {
                font-size: 0.9em;
            }
            
            .tab {
                padding: 10px 15px;
                font-size: 0.9em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üèÜ ÌèâÏÉù ÌÅ¥Îûú Îß§Ïπò ÌÜµÍ≥Ñ ÏÑúÎπÑÏä§</h1>
            <p class="subtitle">Ïã§ÏãúÍ∞Ñ ÏûêÎèô ÏóÖÎç∞Ïù¥Ìä∏ - Îß§ÏãúÍ∞Ñ ÏµúÏã† Îç∞Ïù¥ÌÑ∞ Î∞òÏòÅ</p>
        </div>

        <div class="status-bar" id="statusBar">
            <div>
                <span id="statusText">üü¢ Ïã§ÏãúÍ∞Ñ Îç∞Ïù¥ÌÑ∞ Ïó∞Í≤∞Îê®</span>
                <span class="last-update" id="lastUpdate">ÎßàÏßÄÎßâ ÏóÖÎç∞Ïù¥Ìä∏: -</span>
            </div>
            <button class="refresh-btn" onclick="loadLatestData()">üîÑ ÏÉàÎ°úÍ≥†Ïπ®</button>
        </div>

        <div class="controls">
            <div class="date-controls">
                <label>Í∏∞Í∞Ñ ÏÑ†ÌÉù:</label>
                <input type="date" id="startDate">
                <span>~</span>
                <input type="date" id="endDate">
                <button class="btn" onclick="applyDateFilter()">Í≤ÄÏÉâ</button>
            </div>
            <div class="quick-buttons">
                <button class="btn active" onclick="setQuickFilter('today')">Ïò§Îäò</button>
                <button class="btn" onclick="setQuickFilter('week')">Ïù¥Î≤àÏ£º</button>
                <button class="btn" onclick="setQuickFilter('month')">Ïù¥Î≤àÎã¨</button>
                <button class="btn" onclick="setQuickFilter('all')">Ï†ÑÏ≤¥</button>
            </div>
        </div>

        <div class="stats-grid">
            <div class="stat-card">
                <h3>üìä Ï¥ù Îß§Ïπò Ïàò</h3>
                <div class="stat-value" id="totalMatches">0</div>
                <div class="stat-label">Í≤ΩÍ∏∞</div>
            </div>
            <div class="stat-card">
                <h3>üèÜ ÏäπÎ•†</h3>
                <div class="stat-value" id="winRate">0%</div>
                <div class="stat-label" id="winLossLabel">0Ïäπ 0Ìå®</div>
            </div>
            <div class="stat-card">
                <h3>‚öîÔ∏è Ï¥ù ÌÇ¨</h3>
                <div class="stat-value" id="totalKills">0</div>
                <div class="stat-label">ÌÇ¨</div>
            </div>
            <div class="stat-card">
                <h3>üéØ ÌèâÍ∑† K/D</h3>
                <div class="stat-value" id="avgKD">0.00</div>
                <div class="stat-label">K/D ÎπÑÏú®</div>
            </div>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="showTab('matches')">üìã Îß§Ïπò Í∏∞Î°ù</button>
            <button class="tab" onclick="showTab('players')">üë• ÌÅ¥ÎûúÏõê ÌÜµÍ≥Ñ</button>
            <button class="tab" onclick="showTab('rankings')">üèÖ Îû≠ÌÇπ</button>
        </div>

        <div class="tab-content">
            <div id="matchesTab" class="tab-panel">
                <input type="text" class="search-box" id="matchSearch" 
                       placeholder="Îß§Ïπò Í≤ÄÏÉâ (ÏÉÅÎåÄ ÌÅ¥ÎûúÎ™Ö, ÌîåÎ†àÏù¥Ïñ¥Î™Ö Îì±)..." 
                       onkeyup="filterMatches()">
                <div class="table-container">
                    <table id="matchesTable">
                        <thead>
                            <tr>
                                <th>ÎÇ†Ïßú</th>
                                <th>ÏãúÍ∞Ñ</th>
                                <th>ÌÉÄÏûÖ</th>
                                <th>Í≤∞Í≥º</th>
                                <th>Ï†êÏàò</th>
                                <th>ÏÉÅÎåÄ</th>
                                <th>Ï∞∏Ïó¨ ÌÅ¥ÎûúÏõê</th>
                            </tr>
                        </thead>
                        <tbody id="matchesBody">
                            <tr>
                                <td colspan="7" style="text-align: center;">
                                    <div class="loading">
                                        <div class="spinner"></div>
                                        Îç∞Ïù¥ÌÑ∞Î•º Î∂àÎü¨Ïò§Îäî Ï§ë...
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div id="playersTab" class="tab-panel" style="display: none;">
                <input type="text" class="search-box" id="playerSearch" 
                       placeholder="ÌîåÎ†àÏù¥Ïñ¥ Í≤ÄÏÉâ..." 
                       onkeyup="filterPlayers()">
                <div class="player-stats" id="playerStats">
                    <div class="loading">
                        <div class="spinner"></div>
                        Îç∞Ïù¥ÌÑ∞Î•º Î∂àÎü¨Ïò§Îäî Ï§ë...
                    </div>
                </div>
            </div>

            <div id="rankingsTab" class="tab-panel" style="display: none;">
                <div class="ranking-grid">
                    <div class="ranking-card">
                        <h4>üî• ÏµúÎã§ Ï∞∏Ïó¨</h4>
                        <div id="topParticipation"></div>
                    </div>
                    <div class="ranking-card">
                        <h4>‚öîÔ∏è ÌÇ¨Ïôï</h4>
                        <div id="topKills"></div>
                    </div>
                    <div class="ranking-card">
                        <h4>ü§ù Ïñ¥ÏãúÏôï</h4>
                        <div id="topAssists"></div>
                    </div>
                    <div class="ranking-card">
                        <h4>üéØ Ìó§ÎìúÏÉ∑Ïôï</h4>
                        <div id="topHeadshots"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Ï†ÑÏó≠ Î≥ÄÏàò
        let matchData = [];
        let filteredData = [];
        let autoUpdateInterval;
        
        // GitHub Ï†ÄÏû•ÏÜå Ï†ïÎ≥¥ (Ïù¥ Î∂ÄÎ∂ÑÏùÑ ÏàòÏ†ïÌïòÏÑ∏Ïöî!)
        const GITHUB_USER = 'jina-esfp';  // Ïó¨Í∏∞Ïóê GitHub ÏïÑÏù¥Îîî ÏûÖÎ†•
        const GITHUB_REPO = 'clan-match';            // Ï†ÄÏû•ÏÜå Ïù¥Î¶Ñ
        
        // Îç∞Ïù¥ÌÑ∞ URL
        const DATA_URL = `https://raw.githubusercontent.com/${GITHUB_USER}/${GITHUB_REPO}/main/data.json`;
        
        // ÏµúÏã† Îç∞Ïù¥ÌÑ∞ Î°úÎìú
        async function loadLatestData() {
            const statusBar = document.getElementById('statusBar');
            const statusText = document.getElementById('statusText');
            
            statusBar.className = 'status-bar loading';
            statusText.textContent = 'üîÑ Îç∞Ïù¥ÌÑ∞ ÏóÖÎç∞Ïù¥Ìä∏ Ï§ë...';
            
            try {
                // Ï∫êÏãú Î∞©ÏßÄÎ•º ÏúÑÌïú timestamp Ï∂îÍ∞Ä
                const response = await fetch(DATA_URL + '?t=' + new Date().getTime());
                
                if (response.ok) {
                    matchData = await response.json();
                    
                    // ÎÇ†Ïßú ÌòïÏãù ÌôïÏù∏ Î∞è Î≥ÄÌôò
                    matchData = matchData.map(match => {
                        // dateÍ∞Ä ÏóÜÏúºÎ©¥ match_idÏóêÏÑú Ï∂îÏ∂ú
                        if (!match.date && match.match_id) {
                            const dateStr = match.match_id.substring(0, 8);
                            match.date = `${dateStr.substring(0,4)}-${dateStr.substring(4,6)}-${dateStr.substring(6,8)}`;
                        }
                        return match;
                    });
                    
                    statusBar.className = 'status-bar';
                    statusText.textContent = 'üü¢ Ïã§ÏãúÍ∞Ñ Îç∞Ïù¥ÌÑ∞ Ïó∞Í≤∞Îê®';
                    document.getElementById('lastUpdate').textContent = 
                        `ÎßàÏßÄÎßâ ÏóÖÎç∞Ïù¥Ìä∏: ${new Date().toLocaleString('ko-KR')}`;
                    
                    // ÌòÑÏû¨ ÌïÑÌÑ∞ Ï†ÅÏö©
                    applyCurrentFilter();
                    
                } else {
                    throw new Error('Îç∞Ïù¥ÌÑ∞ Î°úÎìú Ïã§Ìå®');
                }
            } catch (error) {
                console.error('Îç∞Ïù¥ÌÑ∞ Î°úÎìú Ïò§Î•ò:', error);
                statusBar.className = 'status-bar error';
                statusText.textContent = '‚ùå Îç∞Ïù¥ÌÑ∞ Î°úÎìú Ïã§Ìå®';
                
                // Í∏∞Î≥∏ ÏïàÎÇ¥ Î©îÏãúÏßÄ
                if (GITHUB_USER === 'YOUR_GITHUB_USERNAME') {
                    alert('GitHub ÏÑ§Ï†ïÏù¥ ÌïÑÏöîÌï©ÎãàÎã§!\nindex.htmlÏùò GITHUB_USERÎ•º ÏàòÏ†ïÌï¥Ï£ºÏÑ∏Ïöî.');
                }
            }
        }
        
        // ÌòÑÏû¨ ÌïÑÌÑ∞ Îã§Ïãú Ï†ÅÏö©
        function applyCurrentFilter() {
            const startDate = document.getElementById('startDate').value;
            const endDate = document.getElementById('endDate').value;
            
            if (startDate && endDate) {
                applyDateFilter();
            } else {
                setQuickFilter('today');
            }
        }
        
        // ÎÇ†Ïßú ÌïÑÌÑ∞ Ï†ÅÏö©
        function applyDateFilter() {
            const startDate = new Date(document.getElementById('startDate').value);
            const endDate = new Date(document.getElementById('endDate').value);
            endDate.setHours(23, 59, 59, 999); // Ï¢ÖÎ£åÏùºÏùò ÎÅùÍπåÏßÄ Ìè¨Ìï®
            
            filteredData = matchData.filter(match => {
                const matchDate = new Date(match.date);
                return matchDate >= startDate && matchDate <= endDate;
            });
            
            updateDisplay();
        }
        
        // Îπ†Î•∏ ÌïÑÌÑ∞
        function setQuickFilter(period) {
            // Î™®Îì† Î≤ÑÌäº ÎπÑÌôúÏÑ±Ìôî
            document.querySelectorAll('.quick-buttons .btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            const today = new Date();
            const startDate = document.getElementById('startDate');
            const endDate = document.getElementById('endDate');
            
            switch(period) {
                case 'today':
                    startDate.value = today.toISOString().split('T')[0];
                    endDate.value = today.toISOString().split('T')[0];
                    break;
                case 'week':
                    const weekStart = new Date(today);
                    weekStart.setDate(today.getDate() - today.getDay());
                    startDate.value = weekStart.toISOString().split('T')[0];
                    endDate.value = today.toISOString().split('T')[0];
                    break;
                case 'month':
                    const monthStart = new Date(today.getFullYear(), today.getMonth(), 1);
                    startDate.value = monthStart.toISOString().split('T')[0];
                    endDate.value = today.toISOString().split('T')[0];
                    break;
                case 'all':
                    if (matchData.length > 0) {
                        const dates = matchData.map(m => new Date(m.date));
                        const minDate = new Date(Math.min(...dates));
                        const maxDate = new Date(Math.max(...dates));
                        startDate.value = minDate.toISOString().split('T')[0];
                        endDate.value = maxDate.toISOString().split('T')[0];
                    }
                    break;
            }
            
            applyDateFilter();
        }
        
        // ÌôîÎ©¥ ÏóÖÎç∞Ïù¥Ìä∏
        function updateDisplay() {
            updateStats();
            updateMatchesTable();
            updatePlayerStats();
            updateRankings();
        }
        
        // ÌÜµÍ≥Ñ ÏóÖÎç∞Ïù¥Ìä∏
        function updateStats() {
            const totalMatches = filteredData.length;
            const wins = filteredData.filter(m => m.result === 'win').length;
            const losses = totalMatches - wins;
            const winRate = totalMatches > 0 ? (wins / totalMatches * 100).toFixed(1) : 0;
            
            let totalKills = 0;
            let totalDeaths = 0;
            
            filteredData.forEach(match => {
                match.our_team?.forEach(player => {
                    totalKills += player.kills;
                    totalDeaths += player.deaths;
                });
            });
            
            const avgKD = totalDeaths > 0 ? (totalKills / totalDeaths).toFixed(2) : '0.00';
            
            document.getElementById('totalMatches').textContent = totalMatches;
            document.getElementById('winRate').textContent = `${winRate}%`;
            document.getElementById('winLossLabel').textContent = `${wins}Ïäπ ${losses}Ìå®`;
            document.getElementById('totalKills').textContent = totalKills.toLocaleString();
            document.getElementById('avgKD').textContent = avgKD;
        }
        
        // Îß§Ïπò ÌÖåÏù¥Î∏î ÏóÖÎç∞Ïù¥Ìä∏
        function updateMatchesTable() {
            const tbody = document.getElementById('matchesBody');
            tbody.innerHTML = '';
            
            if (filteredData.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="7" style="text-align: center; padding: 40px;">
                            ÏÑ†ÌÉùÌïú Í∏∞Í∞ÑÏóê Îß§Ïπò Í∏∞Î°ùÏù¥ ÏóÜÏäµÎãàÎã§.
                        </td>
                    </tr>
                `;
                return;
            }
            
            filteredData.forEach(match => {
                const players = match.our_team?.map(p => p.name).join(', ') || '-';
                const row = `
                    <tr>
                        <td>${match.date}</td>
                        <td>${match.time}</td>
                        <td>${match.type || '-'}</td>
                        <td class="${match.result}">${match.result === 'win' ? 'Ïäπ' : 'Ìå®'}</td>
                        <td>${match.score?.our || 0}:${match.score?.enemy || 0}</td>
                        <td>${match.opponent || '-'}</td>
                        <td>${players}</td>
                    </tr>
                `;
                tbody.innerHTML += row;
            });
        }
        
        // ÌîåÎ†àÏù¥Ïñ¥ ÌÜµÍ≥Ñ ÏóÖÎç∞Ïù¥Ìä∏
        function updatePlayerStats() {
            const playerData = {};
            
            filteredData.forEach(match => {
                match.our_team?.forEach(player => {
                    if (!playerData[player.name]) {
                        playerData[player.name] = {
                            matches: 0,
                            kills: 0,
                            deaths: 0,
                            headshots: 0,
                            assists: 0,
                            damage: 0,
                            wins: 0
                        };
                    }
                    
                    const stats = playerData[player.name];
                    stats.matches++;
                    stats.kills += player.kills;
                    stats.deaths += player.deaths;
                    stats.headshots += player.headshots;
                    stats.assists += player.assists;
                    stats.damage += player.damage;
                    if (match.result === 'win') stats.wins++;
                });
            });
            
            const container = document.getElementById('playerStats');
            container.innerHTML = '';
            
            if (Object.keys(playerData).length === 0) {
                container.innerHTML = '<div class="loading">ÏÑ†ÌÉùÌïú Í∏∞Í∞ÑÏóê Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§.</div>';
                return;
            }
            
            // Ï∞∏Ïó¨ Í≤ΩÍ∏∞ ÏàòÎ°ú Ï†ïÎ†¨
            const sortedPlayers = Object.entries(playerData).sort((a, b) => b[1].matches - a[1].matches);
            
            sortedPlayers.forEach(([name, stats]) => {
                const kd = stats.deaths > 0 ? (stats.kills / stats.deaths).toFixed(2) : stats.kills;
                const winRate = (stats.wins / stats.matches * 100).toFixed(1);
                
                const card = `
                    <div class="player-card">
                        <div class="player-name">${name}</div>
                        <div class="player-stat">
                            <span>Ï∞∏Ïó¨ Í≤ΩÍ∏∞:</span>
                            <span>${stats.matches}</span>
                        </div>
                        <div class="player-stat">
                            <span>ÏäπÎ•†:</span>
                            <span>${winRate}%</span>
                        </div>
                        <div class="player-stat">
                            <span>ÌÇ¨/Îç∞Ïä§:</span>
                            <span>${stats.kills}/${stats.deaths}</span>
                        </div>
                        <div class="player-stat">
                            <span>K/D:</span>
                            <span>${kd}</span>
                        </div>
                        <div class="player-stat">
                            <span>Ìó§ÎìúÏÉ∑:</span>
                            <span>${stats.headshots}</span>
                        </div>
                        <div class="player-stat">
                            <span>Ïñ¥ÏãúÏä§Ìä∏:</span>
                            <span>${stats.assists}</span>
                        </div>
                        <div class="player-stat">
                            <span>Ï¥ù ÎåÄÎØ∏ÏßÄ:</span>
                            <span>${stats.damage.toLocaleString()}</span>
                        </div>
                    </div>
                `;
                container.innerHTML += card;
            });
        }
        
        // Îû≠ÌÇπ ÏóÖÎç∞Ïù¥Ìä∏
        function updateRankings() {
            const playerData = {};
            
            filteredData.forEach(match => {
                match.our_team?.forEach(player => {
                    if (!playerData[player.name]) {
                        playerData[player.name] = {
                            matches: 0,
                            kills: 0,
                            assists: 0,
                            headshots: 0
                        };
                    }
                    
                    const stats = playerData[player.name];
                    stats.matches++;
                    stats.kills += player.kills;
                    stats.assists += player.assists;
                    stats.headshots += player.headshots;
                });
            });
            
            // Í∞Å Î∂ÄÎ¨∏Î≥Ñ TOP 5
            const players = Object.entries(playerData);
            
            if (players.length === 0) {
                ['topParticipation', 'topKills', 'topAssists', 'topHeadshots'].forEach(id => {
                    document.getElementById(id).innerHTML = '<div style="text-align: center; padding: 20px;">Îç∞Ïù¥ÌÑ∞ ÏóÜÏùå</div>';
                });
                return;
            }
            
            // ÏµúÎã§ Ï∞∏Ïó¨
            const topParticipation = players.sort((a, b) => b[1].matches - a[1].matches).slice(0, 5);
            updateRankingList('topParticipation', topParticipation, 'matches', 'Í≤ΩÍ∏∞');
            
            // ÌÇ¨Ïôï
            const topKills = players.sort((a, b) => b[1].kills - a[1].kills).slice(0, 5);
            updateRankingList('topKills', topKills, 'kills', 'ÌÇ¨');
            
            // Ïñ¥ÏãúÏôï
            const topAssists = players.sort((a, b) => b[1].assists - a[1].assists).slice(0, 5);
            updateRankingList('topAssists', topAssists, 'assists', 'Ïñ¥Ïãú');
            
            // Ìó§ÎìúÏÉ∑Ïôï
            const topHeadshots = players.sort((a, b) => b[1].headshots - a[1].headshots).slice(0, 5);
            updateRankingList('topHeadshots', topHeadshots, 'headshots', 'Ìó§ÎìúÏÉ∑');
        }
        
        function updateRankingList(elementId, data, field, unit) {
            const container = document.getElementById(elementId);
            container.innerHTML = '';
            
            data.forEach(([name, stats], index) => {
                const item = `
                    <div class="ranking-item">
                        <div class="rank-number">#${index + 1}</div>
                        <div class="rank-name">${name}</div>
                        <div class="rank-value">${stats[field]} ${unit}</div>
                    </div>
                `;
                container.innerHTML += item;
            });
        }
        
        // ÌÉ≠ Ï†ÑÌôò
        function showTab(tabName) {
            // Î™®Îì† ÌÉ≠ Î≤ÑÌäº ÎπÑÌôúÏÑ±Ìôî
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');
            
            // Î™®Îì† ÌÉ≠ Ìå®ÎÑê Ïà®Í∏∞Í∏∞
            document.querySelectorAll('.tab-panel').forEach(panel => panel.style.display = 'none');
            
            // ÏÑ†ÌÉùÎêú ÌÉ≠ Ìå®ÎÑê Î≥¥Ïù¥Í∏∞
            document.getElementById(tabName + 'Tab').style.display = 'block';
        }
        
        // Îß§Ïπò ÌïÑÌÑ∞ÎßÅ
        function filterMatches() {
            const searchTerm = document.getElementById('matchSearch').value.toLowerCase();
            const rows = document.querySelectorAll('#matchesBody tr');
            
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchTerm) ? '' : 'none';
            });
        }
        
        // ÌîåÎ†àÏù¥Ïñ¥ ÌïÑÌÑ∞ÎßÅ
        function filterPlayers() {
            const searchTerm = document.getElementById('playerSearch').value.toLowerCase();
            const cards = document.querySelectorAll('.player-card');
            
            cards.forEach(card => {
                const text = card.textContent.toLowerCase();
                card.style.display = text.includes(searchTerm) ? '' : 'none';
            });
        }
        
        // ÏûêÎèô ÏóÖÎç∞Ïù¥Ìä∏ ÏãúÏûë
        function startAutoUpdate() {
            // 1ÏãúÍ∞ÑÎßàÎã§ ÏûêÎèô ÏóÖÎç∞Ïù¥Ìä∏
            autoUpdateInterval = setInterval(() => {
                console.log('ÏûêÎèô Îç∞Ïù¥ÌÑ∞ ÏóÖÎç∞Ïù¥Ìä∏...');
                loadLatestData();
            }, 60 * 60 * 1000); // 1ÏãúÍ∞Ñ
        }
        
        // ÌéòÏù¥ÏßÄ Î°úÎìú Ïãú Ï¥àÍ∏∞Ìôî
        window.onload = async function() {
            // ÎÇ†Ïßú Ï¥àÍ∏∞Í∞í ÏÑ§Ï†ï
            const today = new Date();
            document.getElementById('startDate').value = today.toISOString().split('T')[0];
            document.getElementById('endDate').value = today.toISOString().split('T')[0];
            
            // Îç∞Ïù¥ÌÑ∞ Î°úÎìú
            await loadLatestData();
            
            // ÏûêÎèô ÏóÖÎç∞Ïù¥Ìä∏ ÏãúÏûë
            startAutoUpdate();
        };
        
        // ÌéòÏù¥ÏßÄ Ìè¨Ïª§Ïä§ Ïãú Îç∞Ïù¥ÌÑ∞ ÏÉàÎ°úÍ≥†Ïπ®
        document.addEventListener('visibilitychange', function() {
            if (!document.hidden) {
                loadLatestData();
            }
        });
    </script>
</body>
</html>
