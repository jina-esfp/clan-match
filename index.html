<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í‰ìƒ í´ëœ ë§¤ì¹˜ í†µê³„ ì„œë¹„ìŠ¤</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: #fff;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            background: rgba(255,255,255,0.1);
            padding: 30px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .subtitle {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .status-bar {
            background: rgba(76, 175, 80, 0.9);
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
        }

        .status-bar.loading {
            background: rgba(255, 152, 0, 0.9);
        }

        .status-bar.error {
            background: rgba(244, 67, 54, 0.9);
        }

        .last-update {
            font-size: 0.9em;
        }

        .refresh-btn {
            background: white;
            color: #4CAF50;
            border: none;
            padding: 8px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .refresh-btn:hover {
            background: #f5f5f5;
            transform: translateY(-2px);
        }

        .controls {
            background: rgba(255,255,255,0.1);
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
            backdrop-filter: blur(10px);
        }

        .date-controls {
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
            margin-bottom: 20px;
            justify-content: center;
        }

        .quick-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            background: rgba(255,255,255,0.2);
            color: white;
            border: 1px solid rgba(255,255,255,0.3);
        }

        .btn:hover {
            background: rgba(255,255,255,0.3);
            transform: translateY(-2px);
        }

        .btn.active {
            background: #4CAF50;
            border-color: #4CAF50;
        }

        input[type="date"] {
            padding: 10px 15px;
            border: none;
            border-radius: 8px;
            background: rgba(255,255,255,0.2);
            color: white;
            border: 1px solid rgba(255,255,255,0.3);
            font-size: 16px;
        }

        input[type="date"]::-webkit-calendar-picker-indicator {
            filter: invert(1);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: rgba(255,255,255,0.1);
            padding: 25px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
            transition: all 0.3s ease;
            text-align: center;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            background: rgba(255,255,255,0.15);
        }

        .stat-card h3 {
            margin-bottom: 15px;
            color: #ffd700;
            font-size: 1.1em;
        }

        .stat-value {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .stat-label {
            opacity: 0.8;
            font-size: 0.9em;
        }

        .tabs {
            display: flex;
            gap: 5px;
            margin-bottom: 20px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .tab {
            padding: 12px 24px;
            background: rgba(255,255,255,0.1);
            border: none;
            border-radius: 10px 10px 0 0;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
        }

        .tab.active {
            background: rgba(255,255,255,0.2);
            border-bottom: 3px solid #ffd700;
        }

        .tab-content {
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 25px;
            backdrop-filter: blur(10px);
            min-height: 400px;
        }

        .table-container {
            overflow-x: auto;
            max-height: 600px;
            overflow-y: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: rgba(255,255,255,0.05);
        }

        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        th {
            background: rgba(255,255,255,0.1);
            font-weight: bold;
            position: sticky;
            top: 0;
            z-index: 10;
            color: #ffd700;
        }

        tr:hover {
            background: rgba(255,255,255,0.1);
        }

        .win {
            color: #4CAF50;
            font-weight: bold;
        }

        .lose {
            color: #f44336;
            font-weight: bold;
        }

        .player-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }

        .player-card {
            background: rgba(255,255,255,0.05);
            padding: 20px;
            border-radius: 10px;
            border-left: 4px solid #ffd700;
            transition: all 0.3s ease;
        }

        .player-card:hover {
            background: rgba(255,255,255,0.1);
            transform: translateX(5px);
        }

        .player-name {
            font-weight: bold;
            margin-bottom: 10px;
            color: #ffd700;
            font-size: 1.1em;
        }

        .player-stat {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            padding: 3px 0;
        }

        .loading {
            text-align: center;
            padding: 40px;
            font-size: 1.2em;
        }

        .spinner {
            border: 4px solid rgba(255,255,255,0.3);
            border-top: 4px solid #fff;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .search-box {
            width: 100%;
            max-width: 400px;
            padding: 12px;
            border: none;
            border-radius: 8px;
            background: rgba(255,255,255,0.2);
            color: white;
            margin: 0 auto 20px;
            font-size: 16px;
            display: block;
        }

        .search-box::placeholder {
            color: rgba(255,255,255,0.7);
        }

        .ranking-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .ranking-card {
            background: rgba(255,255,255,0.05);
            padding: 20px;
            border-radius: 10px;
            border-top: 3px solid #ffd700;
        }

        .ranking-card h4 {
            color: #ffd700;
            margin-bottom: 15px;
            text-align: center;
        }

        .ranking-item {
            display: flex;
            align-items: center;
            padding: 10px;
            margin-bottom: 8px;
            background: rgba(255,255,255,0.05);
            border-radius: 5px;
            transition: all 0.3s ease;
        }

        .ranking-item:hover {
            background: rgba(255,255,255,0.1);
            transform: translateX(5px);
        }

        .rank-number {
            font-size: 1.5em;
            font-weight: bold;
            color: #ffd700;
            width: 40px;
            text-align: center;
        }

        .rank-name {
            flex: 1;
            padding: 0 15px;
        }

        .rank-value {
            font-weight: bold;
            color: #4CAF50;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8em;
            }
            
            .date-controls {
                flex-direction: column;
                align-items: stretch;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            table {
                font-size: 0.9em;
            }
            
            .tab {
                padding: 10px 15px;
                font-size: 0.9em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ† í‰ìƒ í´ëœ ë§¤ì¹˜ í†µê³„ ì„œë¹„ìŠ¤</h1>
            <p class="subtitle">ì‹¤ì‹œê°„ ìë™ ì—…ë°ì´íŠ¸ - ë§¤ì‹œê°„ ìµœì‹  ë°ì´í„° ë°˜ì˜</p>
        </div>

        <div class="status-bar" id="statusBar">
            <div>
                <span id="statusText">ğŸŸ¢ ì‹¤ì‹œê°„ ë°ì´í„° ì—°ê²°ë¨</span>
                <span class="last-update" id="lastUpdate">ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: -</span>
            </div>
            <button class="refresh-btn" onclick="loadLatestData()">ğŸ”„ ìƒˆë¡œê³ ì¹¨</button>
        </div>

        <div class="controls">
            <div class="date-controls">
                <label>ê¸°ê°„ ì„ íƒ:</label>
                <input type="date" id="startDate">
                <span>~</span>
                <input type="date" id="endDate">
                <button class="btn" onclick="applyDateFilter()">ê²€ìƒ‰</button>
            </div>
            <div class="quick-buttons">
                <button class="btn active" onclick="setQuickFilter('today')">ì˜¤ëŠ˜</button>
                <button class="btn" onclick="setQuickFilter('week')">ì´ë²ˆì£¼</button>
                <button class="btn" onclick="setQuickFilter('month')">ì´ë²ˆë‹¬</button>
                <button class="btn" onclick="setQuickFilter('all')">ì „ì²´</button>
            </div>
        </div>

        <div class="stats-grid">
            <div class="stat-card">
                <h3>ğŸ“Š ì´ ë§¤ì¹˜ ìˆ˜</h3>
                <div class="stat-value" id="totalMatches">0</div>
                <div class="stat-label">ê²½ê¸°</div>
            </div>
            <div class="stat-card">
                <h3>ğŸ† ìŠ¹ë¥ </h3>
                <div class="stat-value" id="winRate">0%</div>
                <div class="stat-label" id="winLossLabel">0ìŠ¹ 0íŒ¨</div>
            </div>
            <div class="stat-card">
                <h3>âš”ï¸ ì´ í‚¬</h3>
                <div class="stat-value" id="totalKills">0</div>
                <div class="stat-label">í‚¬</div>
            </div>
            <div class="stat-card">
                <h3>ğŸ¯ í‰ê·  K/D</h3>
                <div class="stat-value" id="avgKD">0.00</div>
                <div class="stat-label">K/D ë¹„ìœ¨</div>
            </div>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="showTab('matches')">ğŸ“‹ ë§¤ì¹˜ ê¸°ë¡</button>
            <button class="tab" onclick="showTab('players')">ğŸ‘¥ í´ëœì› í†µê³„</button>
            <button class="tab" onclick="showTab('rankings')">ğŸ… ë­í‚¹</button>
        </div>

        <div class="tab-content">
            <div id="matchesTab" class="tab-panel">
                <input type="text" class="search-box" id="matchSearch" 
                       placeholder="ë§¤ì¹˜ ê²€ìƒ‰ (ìƒëŒ€ í´ëœëª…, í”Œë ˆì´ì–´ëª… ë“±)..." 
                       onkeyup="filterMatches()">
                <div class="table-container">
                    <table id="matchesTable">
                        <thead>
                            <tr>
                                <th>ë‚ ì§œ</th>
                                <th>ì‹œê°„</th>
                                <th>íƒ€ì…</th>
                                <th>ê²°ê³¼</th>
                                <th>ì ìˆ˜</th>
                                <th>ìƒëŒ€</th>
                                <th>ì°¸ì—¬ í´ëœì›</th>
                            </tr>
                        </thead>
                        <tbody id="matchesBody">
                            <tr>
                                <td colspan="7" style="text-align: center;">
                                    <div class="loading">
                                        <div class="spinner"></div>
                                        ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div id="playersTab" class="tab-panel" style="display: none;">
                <input type="text" class="search-box" id="playerSearch" 
                       placeholder="í”Œë ˆì´ì–´ ê²€ìƒ‰..." 
                       onkeyup="filterPlayers()">
                <div class="player-stats" id="playerStats">
                    <div class="loading">
                        <div class="spinner"></div>
                        ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...
                    </div>
                </div>
            </div>

            <div id="rankingsTab" class="tab-panel" style="display: none;">
                <div class="ranking-grid">
                    <div class="ranking-card">
                        <h4>ğŸ”¥ ìµœë‹¤ ì°¸ì—¬</h4>
                        <div id="topParticipation"></div>
                    </div>
                    <div class="ranking-card">
                        <h4>âš”ï¸ í‚¬ì™•</h4>
                        <div id="topKills"></div>
                    </div>
                    <div class="ranking-card">
                        <h4>ğŸ¤ ì–´ì‹œì™•</h4>
                        <div id="topAssists"></div>
                    </div>
                    <div class="ranking-card">
                        <h4>ğŸ¯ í—¤ë“œìƒ·ì™•</h4>
                        <div id="topHeadshots"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ì „ì—­ ë³€ìˆ˜
        let matchData = [];
        let filteredData = [];
        let autoUpdateInterval;
        
        // GitHub ì €ì¥ì†Œ ì •ë³´ (ì´ ë¶€ë¶„ì„ ìˆ˜ì •í•˜ì„¸ìš”!)
        const GITHUB_USER = 'jina-esfp';  // ì—¬ê¸°ì— GitHub ì•„ì´ë”” ì…ë ¥
        const GITHUB_REPO = 'clan-match';            // ì €ì¥ì†Œ ì´ë¦„
        
        // ë°ì´í„° URL
        const DATA_URL = `https://raw.githubusercontent.com/${GITHUB_USER}/${GITHUB_REPO}/main/data.json`;
        
        // ìµœì‹  ë°ì´í„° ë¡œë“œ
        async function loadLatestData() {
            const statusBar = document.getElementById('statusBar');
            const statusText = document.getElementById('statusText');
            
            statusBar.className = 'status-bar loading';
            statusText.textContent = 'ğŸ”„ ë°ì´í„° ì—…ë°ì´íŠ¸ ì¤‘...';
            
            try {
                // ìºì‹œ ë°©ì§€ë¥¼ ìœ„í•œ timestamp ì¶”ê°€
                const response = await fetch(DATA_URL + '?t=' + new Date().getTime());
                
                if (response.ok) {
                    matchData = await response.json();
                    
                    // ë‚ ì§œ í˜•ì‹ í™•ì¸ ë° ë³€í™˜
                    matchData = matchData.map(match => {
                        // dateê°€ ì—†ìœ¼ë©´ match_idì—ì„œ ì¶”ì¶œ
                        if (!match.date && match.match_id) {
                            const dateStr = match.match_id.substring(0, 8);
                            match.date = `${dateStr.substring(0,4)}-${dateStr.substring(4,6)}-${dateStr.substring(6,8)}`;
                        }
                        return match;
                    });
                    
                    statusBar.className = 'status-bar';
                    statusText.textContent = 'ğŸŸ¢ ì‹¤ì‹œê°„ ë°ì´í„° ì—°ê²°ë¨';
                    document.getElementById('lastUpdate').textContent = 
                        `ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: ${new Date().toLocaleString('ko-KR')}`;
                    
                    // í˜„ì¬ í•„í„° ì ìš©
                    applyCurrentFilter();
                    
                } else {
                    throw new Error('ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨');
                }
            } catch (error) {
                console.error('ë°ì´í„° ë¡œë“œ ì˜¤ë¥˜:', error);
                statusBar.className = 'status-bar error';
                statusText.textContent = 'âŒ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨';
                
                // ê¸°ë³¸ ì•ˆë‚´ ë©”ì‹œì§€
                if (GITHUB_USER === 'YOUR_GITHUB_USERNAME') {
                    alert('GitHub ì„¤ì •ì´ í•„ìš”í•©ë‹ˆë‹¤!\nindex.htmlì˜ GITHUB_USERë¥¼ ìˆ˜ì •í•´ì£¼ì„¸ìš”.');
                }
            }
        }
        
        // í˜„ì¬ í•„í„° ë‹¤ì‹œ ì ìš©
        function applyCurrentFilter() {
            const startDate = document.getElementById('startDate').value;
            const endDate = document.getElementById('endDate').value;
            
            if (startDate && endDate) {
                applyDateFilter();
            } else {
                setQuickFilter('today');
            }
        }
        
        // ë‚ ì§œ í•„í„° ì ìš©
        function applyDateFilter() {
            const startDate = new Date(document.getElementById('startDate').value);
            const endDate = new Date(document.getElementById('endDate').value);
            endDate.setHours(23, 59, 59, 999); // ì¢…ë£Œì¼ì˜ ëê¹Œì§€ í¬í•¨
            
            filteredData = matchData.filter(match => {
                const matchDate = new Date(match.date);
                return matchDate >= startDate && matchDate <= endDate;
            });
            
            updateDisplay();
        }
        
        // ë¹ ë¥¸ í•„í„°
        function setQuickFilter(period) {
            // ëª¨ë“  ë²„íŠ¼ ë¹„í™œì„±í™”
            document.querySelectorAll('.quick-buttons .btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            const today = new Date();
            const startDate = document.getElementById('startDate');
            const endDate = document.getElementById('endDate');
            
            switch(period) {
                case 'today':
                    startDate.value = today.toISOString().split('T')[0];
                    endDate.value = today.toISOString().split('T')[0];
                    break;
                case 'week':
                    const weekStart = new Date(today);
                    weekStart.setDate(today.getDate() - today.getDay());
                    startDate.value = weekStart.toISOString().split('T')[0];
                    endDate.value = today.toISOString().split('T')[0];
                    break;
                case 'month':
                    const monthStart = new Date(today.getFullYear(), today.getMonth(), 1);
                    startDate.value = monthStart.toISOString().split('T')[0];
                    endDate.value = today.toISOString().split('T')[0];
                    break;
                case 'all':
                    if (matchData.length > 0) {
                        const dates = matchData.map(m => new Date(m.date));
                        const minDate = new Date(Math.min(...dates));
                        const maxDate = new Date(Math.max(...dates));
                        startDate.value = minDate.toISOString().split('T')[0];
                        endDate.value = maxDate.toISOString().split('T')[0];
                    }
                    break;
            }
            
            applyDateFilter();
        }
        
        // í™”ë©´ ì—…ë°ì´íŠ¸
        function updateDisplay() {
            updateStats();
            updateMatchesTable();
            updatePlayerStats();
            updateRankings();
        }
        
        // í†µê³„ ì—…ë°ì´íŠ¸
        function updateStats() {
            const totalMatches = filteredData.length;
            const wins = filteredData.filter(m => m.result === 'win').length;
            const losses = totalMatches - wins;
            const winRate = totalMatches > 0 ? (wins / totalMatches * 100).toFixed(1) : 0;
            
            let totalKills = 0;
            let totalDeaths = 0;
            
            filteredData.forEach(match => {
                match.our_team?.forEach(player => {
                    totalKills += player.kills;
                    totalDeaths += player.deaths;
                });
            });
            
            const avgKD = totalDeaths > 0 ? (totalKills / totalDeaths).toFixed(2) : '0.00';
            
            document.getElementById('totalMatches').textContent = totalMatches;
            document.getElementById('winRate').textContent = `${winRate}%`;
            document.getElementById('winLossLabel').textContent = `${wins}ìŠ¹ ${losses}íŒ¨`;
            document.getElementById('totalKills').textContent = totalKills.toLocaleString();
            document.getElementById('avgKD').textContent = avgKD;
        }
        
        // ë§¤ì¹˜ í…Œì´ë¸” ì—…ë°ì´íŠ¸
        function updateMatchesTable() {
            const tbody = document.getElementById('matchesBody');
            tbody.innerHTML = '';
            
            if (filteredData.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="7" style="text-align: center; padding: 40px;">
                            ì„ íƒí•œ ê¸°ê°„ì— ë§¤ì¹˜ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.
                        </td>
                    </tr>
                `;
                return;
            }
            
            filteredData.forEach(match => {
                const players = match.our_team?.map(p => p.name).join(', ') || '-';
                const row = `
                    <tr>
                        <td>${match.date}</td>
                        <td>${match.time}</td>
                        <td>${match.type || '-'}</td>
                        <td class="${match.result}">${match.result === 'win' ? 'ìŠ¹' : 'íŒ¨'}</td>
                        <td>${match.score?.our || 0}:${match.score?.enemy || 0}</td>
                        <td>${match.opponent || '-'}</td>
                        <td>${players}</td>
                    </tr>
                `;
                tbody.innerHTML += row;
            });
        }
        
        // í”Œë ˆì´ì–´ í†µê³„ ì—…ë°ì´íŠ¸
        function updatePlayerStats() {
            const playerData = {};
            
            filteredData.forEach(match => {
                match.our_team?.forEach(player => {
                    if (!playerData[player.name]) {
                        playerData[player.name] = {
                            matches: 0,
                            kills: 0,
                            deaths: 0,
                            headshots: 0,
                            assists: 0,
                            damage: 0,
                            wins: 0
                        };
                    }
                    
                    const stats = playerData[player.name];
                    stats.matches++;
                    stats.kills += player.kills;
                    stats.deaths += player.deaths;
                    stats.headshots += player.headshots;
                    stats.assists += player.assists;
                    stats.damage += player.damage;
                    if (match.result === 'win') stats.wins++;
                });
            });
            
            const container = document.getElementById('playerStats');
            container.innerHTML = '';
            
            if (Object.keys(playerData).length === 0) {
                container.innerHTML = '<div class="loading">ì„ íƒí•œ ê¸°ê°„ì— ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
                return;
            }
            
            // ì°¸ì—¬ ê²½ê¸° ìˆ˜ë¡œ ì •ë ¬
            const sortedPlayers = Object.entries(playerData).sort((a, b) => b[1].matches - a[1].matches);
            
            sortedPlayers.forEach(([name, stats]) => {
                const kd = stats.deaths > 0 ? (stats.kills / stats.deaths).toFixed(2) : stats.kills;
                const winRate = (stats.wins / stats.matches * 100).toFixed(1);
                
                const card = `
                    <div class="player-card">
                        <div class="player-name">${name}</div>
                        <div class="player-stat">
                            <span>ì°¸ì—¬ ê²½ê¸°:</span>
                            <span>${stats.matches}</span>
                        </div>
                        <div class="player-stat">
                            <span>ìŠ¹ë¥ :</span>
                            <span>${winRate}%</span>
                        </div>
                        <div class="player-stat">
                            <span>í‚¬/ë°ìŠ¤:</span>
                            <span>${stats.kills}/${stats.deaths}</span>
                        </div>
                        <div class="player-stat">
                            <span>K/D:</span>
                            <span>${kd}</span>
                        </div>
                        <div class="player-stat">
                            <span>í—¤ë“œìƒ·:</span>
                            <span>${stats.headshots}</span>
                        </div>
                        <div class="player-stat">
                            <span>ì–´ì‹œìŠ¤íŠ¸:</span>
                            <span>${stats.assists}</span>
                        </div>
                        <div class="player-stat">
                            <span>ì´ ëŒ€ë¯¸ì§€:</span>
                            <span>${stats.damage.toLocaleString()}</span>
                        </div>
                    </div>
                `;
                container.innerHTML += card;
            });
        }
        
        // ë­í‚¹ ì—…ë°ì´íŠ¸
        function updateRankings() {
            const playerData = {};
            
            filteredData.forEach(match => {
                match.our_team?.forEach(player => {
                    if (!playerData[player.name]) {
                        playerData[player.name] = {
                            matches: 0,
                            kills: 0,
                            assists: 0,
                            headshots: 0
                        };
                    }
                    
                    const stats = playerData[player.name];
                    stats.matches++;
                    stats.kills += player.kills;
                    stats.assists += player.assists;
                    stats.headshots += player.headshots;
                });
            });
            
            // ê° ë¶€ë¬¸ë³„ TOP 5
            const players = Object.entries(playerData);
            
            if (players.length === 0) {
                ['topParticipation', 'topKills', 'topAssists', 'topHeadshots'].forEach(id => {
                    document.getElementById(id).innerHTML = '<div style="text-align: center; padding: 20px;">ë°ì´í„° ì—†ìŒ</div>';
                });
                return;
            }
            
            // ìµœë‹¤ ì°¸ì—¬
            const topParticipation = players.sort((a, b) => b[1].matches - a[1].matches).slice(0, 5);
            updateRankingList('topParticipation', topParticipation, 'matches', 'ê²½ê¸°');
            
            // í‚¬ì™•
            const topKills = players.sort((a, b) => b[1].kills - a[1].kills).slice(0, 5);
            updateRankingList('topKills', topKills, 'kills', 'í‚¬');
            
            // ì–´ì‹œì™•
            const topAssists = players.sort((a, b) => b[1].assists - a[1].assists).slice(0, 5);
            updateRankingList('topAssists', topAssists, 'assists', 'ì–´ì‹œ');
            
            // í—¤ë“œìƒ·ì™•
            const topHeadshots = players.sort((a, b) => b[1].headshots - a[1].headshots).slice(0, 5);
            updateRankingList('topHeadshots', topHeadshots, 'headshots', 'í—¤ë“œìƒ·');
        }
        
        function updateRankingList(elementId, data, field, unit) {
            const container = document.getElementById(elementId);
            container.innerHTML = '';
            
            data.forEach(([name, stats], index) => {
                const item = `
                    <div class="ranking-item">
                        <div class="rank-number">#${index + 1}</div>
                        <div class="rank-name">${name}</div>
                        <div class="rank-value">${stats[field]} ${unit}</div>
                    </div>
                `;
                container.innerHTML += item;
            });
        }
        
        // íƒ­ ì „í™˜
        function showTab(tabName) {
            // ëª¨ë“  íƒ­ ë²„íŠ¼ ë¹„í™œì„±í™”
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');
            
            // ëª¨ë“  íƒ­ íŒ¨ë„ ìˆ¨ê¸°ê¸°
            document.querySelectorAll('.tab-panel').forEach(panel => panel.style.display = 'none');
            
            // ì„ íƒëœ íƒ­ íŒ¨ë„ ë³´ì´ê¸°
            document.getElementById(tabName + 'Tab').style.display = 'block';
        }
        
        // ë§¤ì¹˜ í•„í„°ë§
        function filterMatches() {
            const searchTerm = document.getElementById('matchSearch').value.toLowerCase();
            const rows = document.querySelectorAll('#matchesBody tr');
            
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchTerm) ? '' : 'none';
            });
        }
        
        // í”Œë ˆì´ì–´ í•„í„°ë§
        function filterPlayers() {
            const searchTerm = document.getElementById('playerSearch').value.toLowerCase();
            const cards = document.querySelectorAll('.player-card');
            
            cards.forEach(card => {
                const text = card.textContent.toLowerCase();
                card.style.display = text.includes(searchTerm) ? '' : 'none';
            });
        }
        
        // ìë™ ì—…ë°ì´íŠ¸ ì‹œì‘
        function startAutoUpdate() {
            // 1ì‹œê°„ë§ˆë‹¤ ìë™ ì—…ë°ì´íŠ¸
            autoUpdateInterval = setInterval(() => {
                console.log('ìë™ ë°ì´í„° ì—…ë°ì´íŠ¸...');
                loadLatestData();
            }, 60 * 60 * 1000); // 1ì‹œê°„
        }
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        window.onload = async function() {
            // ë‚ ì§œ ì´ˆê¸°ê°’ ì„¤ì •
            const today = new Date();
            document.getElementById('startDate').value = today.toISOString().split('T')[0];
            document.getElementById('endDate').value = today.toISOString().split('T')[0];
            
            // ë°ì´í„° ë¡œë“œ
            await loadLatestData();
            
            // ìë™ ì—…ë°ì´íŠ¸ ì‹œì‘
            startAutoUpdate();
        };
        
        // í˜ì´ì§€ í¬ì»¤ìŠ¤ ì‹œ ë°ì´í„° ìƒˆë¡œê³ ì¹¨
        document.addEventListener('visibilitychange', function() {
            if (!document.hidden) {
                loadLatestData();
            }
        });
    </script>
</body>
</html>
